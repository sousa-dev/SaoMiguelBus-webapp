<!DOCTYPE html>
<html lang="pt" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle" data-i18n="pageTitle">São Miguel Bus | Horários e Rotas de Autocarros na Ilha de São Miguel, Açores</title>
    <meta name="description" content="São Miguel Bus by Sousa Dev: Encontre horários e rotas de autocarros na Ilha de São Miguel, Açores. Planeie sua viagem com facilidade usando nossa ferramenta de busca de transporte público em São Miguel.">
    <meta name="keywords" content="São Miguel Bus, Sao Miguel Bus, autocarros São Miguel, autocarros sao miguel, transporte público São Miguel, rotas de autocarro Açores, ônibus São Miguel, bus schedule Azores, public transport São Miguel Island">    
    <meta name="monetag" content="dc40a4dc94c1d8ad17136ef2d06a51df">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="São Miguel Bus | Horários e Rotas de Autocarros na Ilha de São Miguel, Açores">
    <meta property="og:description" content="São Miguel Bus: Encontre horários e rotas de autocarros na Ilha de São Miguel, Açores. Planeie sua viagem com nossa ferramenta de busca de transporte público.">
    <meta property="og:image" content="https://www.saomiguelbus.com/static/img/og-image.png"> 
    <meta property="og:url" content="https://www.saomiguelbus.com">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Umami Analytics -->
    <script>
        if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
          // Load the Umami script only when not on localhost
          const script = document.createElement('script');
          script.defer = true;
          script.src = 'https://umami-analytics.ovhcloud-vps.sousadev.com/script.js';
          script.setAttribute('data-website-id', 'f6d6a571-6fc6-4bb6-8357-22656757061e');
          document.head.appendChild(script);
        }
    </script>

    <!-- Google Tag Manager -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YSWK1F7F0B"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-YSWK1F7F0B');
    </script>

    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8246676797736648" crossorigin="anonymous"></script>
    <!-- Structured Data for SEO -->
    <script type="application/ld+json">
        {
        "@context": "https://schema.org",
        "@type": "LocalBusiness",
        "name": "São Miguel Bus",
        "url": "https://www.saomiguelbus.com",
        "logo": "https://www.saomiguelbus.com/static/img/logo-playstore.png",
        "sameAs": [
            "https://www.linkedin.com/in/henriquecsousa/",
            "https://www.instagram.com/sousadev/",
            "https://www.twitter.com/sousadev/",
            "https://www.github.com/hc-sousa/"
        ],
        "contactPoint": {
            "@type": "ContactPoint",
            "contactType": "Customer Service",
            "email": "info@saomiguelbus.com"
        },
        "description": "São Miguel Bus oferece informações atualizadas sobre horários e rotas de autocarros na Ilha de São Miguel, ajudando-o a encontrar a melhor opção de transporte para sua viagem."
        }
    </script>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="static/favicon/favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="static/favicon/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="static/favicon/favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="static/favicon/apple-touch-icon.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#28a745">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="São Miguel Bus">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" crossorigin="anonymous" data-i18n="fontAwesomeLink">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
        integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
        crossorigin=""/>
    
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
        integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
        crossorigin=""></script>
    <!-- Iconify -->
    <script src="https://code.iconify.design/2/2.1.2/iconify.min.js" crossorigin="anonymous"></script>

    <style>
        /* Import Poppins font */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');

        /* Apply Poppins font to all elements */
        * {
            font-family: 'Poppins', sans-serif;
        }
        /* Ajuste para scroll no mobile */
        @media (max-width: 1024px) {
            body {
                padding-bottom: 56px; /* Altura da navbar inferior */
            }
            .page {
                display: none;
                min-height: calc(100vh - 56px); /* Ajuste para a altura da navbar inferior */
                overflow-y: auto;
                padding-bottom: 20px; /* Espaço extra no final da página */
            }
            .page.active {
                display: block;
            }
        }
        /* Animation for swap icon */
        @keyframes rotateIcon {
            from { transform: rotate(90deg); }
            to { transform: rotate(270deg); }
        }
        .rotate-icon {
            animation: rotateIcon 0.3s ease-in-out;
        }

        /* Additional styles */
        #language {
            width: 100%;
        }

        .container.card {
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 8px;
            margin-top: 30px;
            cursor: pointer; /* Make the card look clickable */
        }

        .route-header {
            display: flex;
            align-items: center;
            font-size: 20px;
            margin-bottom: 10px;
        }

        .route-icon {
            margin-right: 10px;
            font-size: 24px;
        }

        .route-number {
            font-weight: bold;
        }

        .stops-summary {
            margin-top: 10px;
        }

        .stop, .transfer {
            font-size: 16px;
            margin-bottom: 5px;
        }

        .transfer-icon {
            margin-right: 5px;
        }

        .route-footer {
            margin-top: 10px;
            font-weight: bold;
        }

        .intermediate-stops {
            overflow: hidden;
            transition: max-height 0.5s ease-out; /* Add transition for animation */
        }

        .grey-out {
            position: relative;
        }

        .grey-out::after {
            content: "";
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(128, 128, 128, 0.1); /* grey with 50% opacity */
        }

        .tm-about-text-wrap {
            margin-bottom: 30px;
        }

        #languageModal {
            display: none;
            align-items: center;
            justify-content: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        #languageModal .bg-white {
            max-width: 400px;
            margin: auto;
            padding: 20px;
            border-radius: 8px;
        }

        /* New styles for fixed ad and scrollable content */
        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        #placeHolderForAd {
            position: sticky;
            top: 0;
            z-index: 10;
            background-color: white;
        }

        .page {
            flex: 1;
            overflow-y: auto;
            display: none;
        }
        .page.active {
            display: block;
        }

        /* Improved language picker styling */
        #languageModal .bg-white {
            max-width: 600px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        #languageModal ul {
            list-style-type: none;
            padding: 0;
        }

        #languageModal li {
            margin-bottom: 10px;
        }

        #languageModal button {
            align-items: center;
            width: 100%;
            padding: 10px;
            border: none;
            background-color: #f3f4f6;
            border-radius: 8px;
            transition: background-color 0.3s ease;
        }

        #languageModal button:hover {
            background-color: #e5e7eb;
        }

        #languageModal button span {
            margin-right: 10px;
            font-size: 1.5em;
        }

        #closeModal {
            width: auto !important;
            background: none !important;
            text-align: right !important;
            float: right !important;
            margin: 0px !important;
        }

        /* Desktop styles */
        @media (min-width: 1025px) {
            body {
                padding-bottom: 0;
            }
            .page {
                max-width: 800px;
                margin: 0 auto;
                padding: 20px;
            }
            .bottom-0 {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background-color: white;
                box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            }
            #scrollToTopBtn {
                bottom: 20px;
                left: calc(50% - 400px - 60px); /* Adjust based on page max-width */
            }
            #alertButton {
                top: 20px;
                right: calc(50% - 400px - 60px); /* Adjust based on page max-width */
            }
            #alertModal .bg-white {
                width: 400px;
            }
        }
    </style>
</head>

<body class="bg-white text-gray-800">
    <!-- Ad Placeholder (fixed at the top) -->
    <div id="placeHolderForAd" class="relative border-b-2 border-gray-300 max-w-md mx-auto mb-1 p-1 rounded-lg" style="min-height: 80px;">
        <!-- The ad banner will be inserted here by JavaScript -->
    </div>

    <!-- Desktop Banner -->
    <div id="desktopBanner" class="hidden lg:block fixed left-4 top-1/2 transform -translate-y-1/2 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 max-w-xs shadow-lg rounded-r-lg z-50">
        <p class="font-bold" data-i18n="alertModalTitle">Alertas</p>
        <p class="text-sm" data-i18n="desktopBannerText">Este Website está desenvolvido para ser usado em dispositivos móveis. Pode usá-lo no computador, mas a experiência será melhor no telemóvel. Aceda a saomiguelbus.com no navegador do seu smartphone!</p>
        <button onclick="dismissBanner()" class="absolute top-2 right-2 text-yellow-700 hover:text-yellow-900" aria-label="Fechar aviso" data-umami-event="dismiss-desktop-banner">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <script>
        function dismissBanner() {
            document.getElementById('desktopBanner').style.display = 'none';
        }
    </script>

    <!-- Scroll to Top Button -->
    <button id="scrollToTopBtn" class="fixed bottom-20 left-4 z-50 bg-green-500 text-white rounded-full p-3 hidden transition-opacity duration-300 ease-in-out opacity-0 lg:bottom-4" aria-label="Scroll to top" data-umami-event="scroll-to-top">
        <i class="fas fa-chevron-up"></i>
    </button>

    <!-- Alert Messages -->
    <div id="alertMessages" class="fixed top-20 right-4 z-50 hidden">
        <!-- Alert Icon Button -->
        <button id="alertButton" class="fixed top-20 right-4 z-50 bg-red-500 text-white rounded-full px-4 shadow-lg focus:outline-none" onclick="toggleAlertModal()" data-umami-event="open-alert-modal">
            <i class="fas fa-bell text-xs"></i>
            <span id="alertBadge" class="absolute -top-1 -right-1 bg-yellow-500 text-[10px] text-white rounded-full w-4 h-4 flex items-center justify-center">0</span>
        </button>

        <!-- Alert Messages Modal -->
        <div id="alertModal" class="fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center hidden">
            <div class="bg-white rounded-lg p-6 w-80 relative">
                <button onclick="toggleAlertModal()" id="closeAlertModal" class="text-gray-600 w-full text-right hover:text-gray-800 transition duration-300 ease-in-out mb-2" data-umami-event="close-alert-modal">
                    <i class="fas fa-times text-xl text-right"></i>
                </button>
                <h3 class="text-xl font-semibold text-green-600 mb-3" data-i18n="alertModalTitle">Alertas</h3>
                <div id="alertContent" class="mb-4 overflow-y-auto h-60">
                    <!-- Alert messages will be inserted here -->
                </div>
                <p class="text-sm text-gray-500" data-i18n="alertModalEnd">Estes avisos foram publicados pelas companhias de autocarros e/ou entidades competentes.</p>
            </div>
        </div>
    </div>

    <script>
        function toggleAlertModal() {
            const alertModal = document.getElementById('alertModal');
            alertModal.classList.toggle('hidden');
        }
    </script>

    <!-- <script src="https://chat.yourgenlab.com/v1/embed.js?agent=42"></script>
    <script>
        initAIChatWidget({
                "agentId": "42",
                "useRecaptcha": true,
                "themeVariant": "forest",
                "theme": "light",
                "fontFamilt": "Poppins, sans-serif",
                "introMessage": "Olá, como posso ajudar?",
                "height": "70vh",
                "width": "80vw",
                "position": "bottom-right",
                "yOffset": "7%",
                "xOffset": "2%",
                "webhookURL": "https://chat.yourgenlab.com/ai/api/webhook/",
            });
    </script> -->

    <script>
        // Scroll to Top functionality
        const scrollToTopBtn = document.getElementById("scrollToTopBtn");

        window.addEventListener("scroll", () => {
            if (window.pageYOffset > 100) {
                scrollToTopBtn.classList.remove("hidden", "opacity-0");
                scrollToTopBtn.classList.add("opacity-100");
            } else {
                scrollToTopBtn.classList.remove("opacity-100");
                scrollToTopBtn.classList.add("opacity-0");
            }
        });

        scrollToTopBtn.addEventListener("click", () => {
            window.scrollTo({
                top: 0,
                behavior: "smooth"
            });
        });
    </script>
    
    <!-- Bottom Navigation Bar -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white rounded-t-lg z-50 max-w-md mx-auto">
        <div class="flex max-w-2xl mx-auto">
            <a href="#" class="flex flex-col items-center justify-center text-gray-600 hover:text-green-600 py-2 flex-1" data-target="home" data-umami-event="nav-home">
                <i class="fas fa-bus text-xl"></i>
                <span id="navBarSearchLabel" class="text-xs" data-i18n="navBarSearchLabel">Rotas</span>
            </a>
            <a id="navDirectionsButton" href="#" class="flex flex-col items-center justify-center text-gray-600 hover:text-green-600 py-2 flex-1" data-target="routes" data-umami-event="nav-routes">
                <i class="fas fa-route text-xl"></i>
                <span id="navBarRoutesLabel" class="text-xs" data-i18n="navBarRoutesLabel">Direções</span>
            </a>
            <a href="#" class="flex flex-col items-center justify-center text-gray-600 hover:text-green-600 py-2 flex-1" data-target="tours" data-umami-event="nav-tours">
                <i class="fas fa-map-marked-alt text-xl"></i>
                <span id="navBarToursLabel" class="text-xs" data-i18n="navBarToursLabel">Tours</span>
            </a>
            <a href="#" class="flex flex-col items-center justify-center text-gray-600 hover:text-green-600 py-2 flex-1" data-target="advert" data-umami-event="nav-advert">
                <i class="fas fa-crown text-xl"></i>
                <span id="navBarAdvertLabel" class="text-xs" data-i18n="navBarAdvertLabel">Anúncios</span>
            </a>
            <a href="#" class="flex flex-col items-center justify-center text-gray-600 hover:text-green-600 py-2 flex-1" data-target="info" data-umami-event="nav-info">
                <i class="fas fa-info-circle text-xl"></i>
                <span id="navBarInfoLabel" class="text-xs" data-i18n="navBarInfoLabel">Info</span>
            </a>
        </div>
    </nav>

    <!-- Bottom Sticky Ad Banner -->
    <div id="bottomStickyAd" class="ad-banner fixed bottom-14 left-0 right-0 z-40 max-w-md mx-auto" style="display: none;">
        <div id="bottomStickyAdContent" class="bg-gradient-to-r from-red-500 to-orange-500 text-white p-2 mx-2 rounded-lg shadow-lg cursor-pointer hover:shadow-xl transition-shadow duration-200" onclick="showPricingModal()" data-umami-event="bottom-sticky-ad-click">
            <!-- Content will be dynamically inserted here -->
        </div>
    </div>

    <script>
        // Function to set random bottom sticky ad styles
        function setRandomBottomStickyAdStyles() {
            const contentElement = document.getElementById('bottomStickyAdContent');
            if (!contentElement) return;

            const adVariations = [
                {
                    // Original remove ads variation
                    gradient: 'bg-gradient-to-r from-red-500 to-orange-500',
                    content: `
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <i class="fas fa-crown text-lg mr-2"></i>
                                <div>
                                    <p class="font-bold text-xs" data-i18n="removeAdsTitle">REMOVE ADS</p>
                                    <p class="text-xs opacity-90" data-i18n="clickToRemoveAds">Click to remove ads</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button onclick="event.stopPropagation(); showPricingModal()" class="bg-white text-red-500 px-3 py-1 rounded text-xs font-bold hover:bg-gray-100" data-umami-event="bottom-sticky-ad-upgrade">
                                    <span data-i18n="upgradeButton">UPGRADE</span>
                                </button>
                                <button onclick="event.stopPropagation(); dismissBottomAd()" class="text-white hover:text-gray-200" aria-label="Close ad" data-umami-event="dismiss-bottom-ad">
                                    <i class="fas fa-times text-sm"></i>
                                </button>
                            </div>
                        </div>
                    `
                },
                {
                    // New bus tracking variation
                    gradient: 'bg-gradient-to-r from-blue-500 to-teal-500',
                    content: `
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <i class="fas fa-location-arrow text-lg mr-2"></i>
                                <div>
                                    <p class="font-bold text-xs" data-i18n="trackBusesTitle">TRACK BUSES</p>
                                    <p class="text-xs opacity-90" data-i18n="realTimeTrackingText">Real-time arrival estimates</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button onclick="event.stopPropagation(); showPricingModal()" class="bg-white text-blue-500 px-3 py-1 rounded text-xs font-bold hover:bg-gray-100" data-umami-event="bottom-sticky-ad-tracking">
                                    <span data-i18n="unlockButton">UNLOCK</span>
                                </button>
                                <button onclick="event.stopPropagation(); dismissBottomAd()" class="text-white hover:text-gray-200" aria-label="Close ad" data-umami-event="dismiss-bottom-ad">
                                    <i class="fas fa-times text-sm"></i>
                                </button>
                            </div>
                        </div>
                    `
                },
                {
                    // New pin routes variation
                    gradient: 'bg-gradient-to-r from-green-500 to-emerald-500',
                    content: `
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <i class="fas fa-thumbtack text-lg mr-2"></i>
                                <div>
                                    <p class="font-bold text-xs" data-i18n="pinRoutesTitle">PIN ROUTES</p>
                                    <p class="text-xs opacity-90" data-i18n="dailyTrackingText">Track your daily routes</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button onclick="event.stopPropagation(); showPricingModal()" class="bg-white text-green-500 px-3 py-1 rounded text-xs font-bold hover:bg-gray-100" data-umami-event="bottom-sticky-ad-pin">
                                    <span data-i18n="getPremiumText">GET PRO</span>
                                </button>
                                <button onclick="event.stopPropagation(); dismissBottomAd()" class="text-white hover:text-gray-200" aria-label="Close ad" data-umami-event="dismiss-bottom-ad">
                                    <i class="fas fa-times text-sm"></i>
                                </button>
                            </div>
                        </div>
                    `
                }
            ];

            // Randomly choose a variation
            const randomVariation = adVariations[Math.floor(Math.random() * adVariations.length)];
            
            // Apply the gradient class and content
            contentElement.className = `text-white p-2 mx-2 rounded-lg shadow-lg cursor-pointer hover:shadow-xl transition-shadow duration-200 ${randomVariation.gradient}`;
            contentElement.innerHTML = randomVariation.content;

            // Update translations if they're loaded
            if (typeof updatePageContent === 'function') {
                updatePageContent();
            }
        }

        function dismissBottomAd() {
            document.getElementById('bottomStickyAd').style.display = 'none';
            // Set a session flag to prevent showing again this session
            sessionStorage.setItem('bottomAdDismissed', 'true');
        }
        
        // Initialize bottom sticky ad content immediately on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Set initial random style immediately so content is ready
            setRandomBottomStickyAdStyles();
        });

        // Show bottom ad after 10 seconds if not dismissed and not premium
        // Only show once per session
        setTimeout(() => {
            if (!sessionStorage.getItem('bottomAdDismissed') && !(adRemovalState && adRemovalState.isActive)) {
                // Small delay to ensure content is rendered, then show
                setTimeout(() => {
                    document.getElementById('bottomStickyAd').style.display = 'block';
                }, 100);
            }
        }, 10000);

        // Change bottom sticky ad style every 45 seconds if it's visible
        setInterval(() => {
            const bottomAd = document.getElementById('bottomStickyAd');
            if (bottomAd && bottomAd.style.display !== 'none' && !sessionStorage.getItem('bottomAdDismissed') && !(adRemovalState && adRemovalState.isActive)) {
                setRandomBottomStickyAdStyles();
            }
        }, 45000);
    </script>

    <!-- Language Selection Modal -->
    <div id="languageModal" class="fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-lg p-6 w-80 relative max-h-[90vh] overflow-y-auto">
            <button id="closeModal" class="text-gray-600 w-full text-right hover:text-gray-800 transition duration-300 ease-in-out mb-2" data-umami-event="close-language-modal">
                <i class="fas fa-times text-xl text-right"></i>
            </button>
            
            <!-- Machine Translation Warning -->
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-4">
                <div class="flex items-center">
                    <i class="fas fa-exclamation-triangle text-yellow-600 mr-2"></i>
                    <span class="text-sm text-yellow-800">
                        <span data-i18n="machineTranslationWarning">Languages are machine-translated. Errors may be present.</span>
                    </span>
                </div>
            </div>
            
            <ul class="max-h-60 overflow-y-auto space-y-1">
                <li>
                    <button onclick="changeLanguage('pt')" class="w-full text-left py-2" data-umami-event="change-language-pt">
                        <span>🇵🇹</span> Português
                    </button>
                </li>
                <li>
                    <button onclick="changeLanguage('en')" class="w-full text-left py-2" data-umami-event="change-language-en">
                        <span>🇬🇧</span> English
                    </button>
                </li>
                <li>
                    <button onclick="changeLanguage('es')" class="w-full text-left py-2" data-umami-event="change-language-es">
                        <span>🇪🇸</span> Español
                    </button>
                </li>
                <li>
                    <button onclick="changeLanguage('fr')" class="w-full text-left py-2" data-umami-event="change-language-fr">
                        <span>🇫🇷</span> Français
                    </button>
                </li>
                <li>
                    <button onclick="changeLanguage('de')" class="w-full text-left py-2" data-umami-event="change-language-de">
                        <span>🇩🇪</span> Deutsch
                    </button>
                </li>
                <li>
                    <button onclick="changeLanguage('it')" class="w-full text-left py-2" data-umami-event="change-language-it">
                        <span>🇮🇹</span> Italiano
                    </button>
                </li>
                <li>
                    <button onclick="changeLanguage('uk')" class="w-full text-left py-2" data-umami-event="change-language-uk">
                        <span>🇺🇦</span> Українська
                    </button>
                </li>
                <li>
                    <button onclick="changeLanguage('zh')" class="w-full text-left py-2" data-umami-event="change-language-zh">
                        <span>🇨🇳</span> 中文
                    </button>
                </li>
            </ul>
        </div>
    </div>

    <div id="loadingSpinner" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
        <div class="animate-spin rounded-full h-32 w-32 border-t-2 border-b-2 border-green-500"></div>
    </div>

    <!-- Pricing Selection Modal -->
    <div id="pricingModal" class="fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center hidden p-4">
        <div class="bg-white rounded-lg p-4 sm:p-6 w-full max-w-sm sm:max-w-md mx-auto relative max-h-[90vh] overflow-y-auto">
            <button id="closePricingModal" class="text-gray-600 w-full text-right hover:text-gray-800 transition duration-300 ease-in-out mb-2">
                <i class="fas fa-times text-xl text-right"></i>
            </button>
            
            <div class="text-center mb-4 sm:mb-6">
                <i class="fas fa-crown text-3xl sm:text-4xl text-yellow-500 mb-3 sm:mb-4"></i>
                <h3 class="text-lg sm:text-xl font-semibold text-green-600 mb-2" data-i18n="getPremiumTitle">Get Premium</h3>
                <p class="text-sm sm:text-base text-gray-700 mb-3 sm:mb-4" data-i18n="premiumDescription">
                    Unlock advanced bus tracking features and enjoy an ad-free experience.
                </p>
                <p class="text-xs sm:text-sm text-green-600 font-medium" data-i18n="supportDeveloper">
                    Bonus: Support an Azorean Solo Developer. (Yes, this app is not developed by any company, it is just one guy)
                </p>
            </div>
            
            <!-- Pricing Options -->
            <div class="space-y-2 sm:space-y-3 mb-4 sm:mb-6">
                <div id="pricing-option-weekly" class="pricing-option border-2 border-gray-200 bg-white rounded-lg p-3 sm:p-4 cursor-pointer hover:border-green-300 transition-colors" onclick="selectPricingOption('weekly')" data-umami-event="select-pricing-weekly">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="w-4 h-4 border-2 border-gray-300 rounded-full mr-3"></div>
                            <div>
                                <div class="font-semibold text-base sm:text-lg">€0.50<span class="text-xs sm:text-sm text-gray-500" data-i18n="perWeek">/week</span></div>
                                <div class="text-xs sm:text-sm text-gray-600" data-i18n="weeklyDescription">Perfect for tourists</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="pricing-option-monthly" class="pricing-option border-2 border-gray-200 bg-white rounded-lg p-3 sm:p-4 cursor-pointer hover:border-green-300 transition-colors" onclick="selectPricingOption('monthly')" data-umami-event="select-pricing-monthly">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="w-4 h-4 border-2 border-gray-300 rounded-full mr-3"></div>
                            <div>
                                <div class="font-semibold text-base sm:text-lg">€1.99<span class="text-xs sm:text-sm text-gray-500" data-i18n="perMonth">/month</span></div>
                                <div class="text-xs sm:text-sm text-gray-600" data-i18n="monthlyDescription">Most popular</div>
                            </div>
                        </div>
                        <div class="bg-blue-500 text-white text-xs font-bold px-2 py-1 rounded-full">
                            <span data-i18n="freeTrialBadge">14-day free trial</span>
                        </div>
                    </div>
                </div>
                
                <div id="pricing-option-yearly" class="pricing-option border-2 border-gray-200 bg-white rounded-lg p-3 sm:p-4 cursor-pointer hover:border-green-300 transition-colors" onclick="selectPricingOption('yearly')" data-umami-event="select-pricing-yearly">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="w-4 h-4 border-2 border-gray-300 rounded-full mr-3"></div>
                            <div>
                                <div class="font-semibold text-base sm:text-lg">€19.99<span class="text-xs sm:text-sm text-gray-500" data-i18n="perYear">/year</span></div>
                                <div class="text-xs sm:text-sm text-gray-600" data-i18n="yearlyDescription">Save 17%</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Subscribe Button -->
            <button onclick="subscribeToSelectedPlan()" 
                    id="subscribeButton"
                    class="w-full bg-green-500 text-white py-2 sm:py-3 rounded-lg hover:bg-green-600 transition duration-300 mb-3 sm:mb-4 text-sm sm:text-base"
                    data-umami-event="subscribe-premium">
                <i class="fas fa-crown mr-2"></i>
                <span id="subscribeButtonText" data-i18n="getPremiumButton">Get Premium</span>
            </button>
            
            <!-- Already Subscribed Link -->
            <div class="text-center mb-3 sm:mb-4">
                <button onclick="showEmailVerificationModal()" 
                        class="text-blue-500 hover:text-blue-700 text-xs sm:text-sm underline"
                        data-umami-event="already-subscribed-link">
                    <span data-i18n="alreadySubscribed">I already have a subscription enabled</span>
                </button>
            </div>
            
            <!-- Premium Features List -->
            <div class="bg-green-50 border border-green-200 rounded-lg p-3 sm:p-4 mb-4 sm:mb-6">
                <h4 class="font-semibold text-green-800 mb-3 text-sm sm:text-base" data-i18n="premiumFeaturesTitle">Premium Features:</h4>
                <ul class="text-xs sm:text-sm text-green-700 space-y-2">
                    <li class="flex items-start">
                        <i class="fas fa-location-arrow text-green-500 mr-2 mt-0.5 flex-shrink-0"></i>
                        <span data-i18n="premiumFeatureBusTracking">Real-time bus tracking and arrival estimates</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-thumbtack text-green-500 mr-2 mt-0.5 flex-shrink-0"></i>
                        <span data-i18n="premiumFeaturePinnedRoutes">Pin favorite routes for daily tracking</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-ad text-green-500 mr-2 mt-0.5 flex-shrink-0"></i>
                        <span data-i18n="premiumFeature1">No advertisements</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-headset text-green-500 mr-2 mt-0.5 flex-shrink-0"></i>
                        <span data-i18n="premiumFeature2">Priority support</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-star text-green-500 mr-2 mt-0.5 flex-shrink-0"></i>
                        <span data-i18n="premiumFeature3">Early access to new features</span>
                    </li>
                </ul>
            </div>
            
            <p class="text-xs text-gray-500 text-center" data-i18n="premiumTerms">
                By subscribing, you agree to our Terms of Service and Privacy Policy.
            </p>
        </div>
    </div>

    <!-- Remove Pinned Route Confirmation Modal -->
    <div id="removePinnedRouteModal" class="fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center hidden p-4">
        <div class="bg-white rounded-lg p-4 sm:p-6 w-full max-w-sm sm:max-w-md mx-auto relative max-h-[90vh] overflow-y-auto">
            <button id="closeRemovePinnedRouteModal" class="text-gray-600 w-full text-right hover:text-gray-800 transition duration-300 ease-in-out mb-2" onclick="BusTrackingHandler.closeRemovePinnedRouteModal()">
                <i class="fas fa-times text-xl text-right"></i>
            </button>
            
            <div class="text-center mb-4 sm:mb-6">
                <i class="fas fa-exclamation-triangle text-3xl sm:text-4xl text-red-500 mb-3 sm:mb-4"></i>
                <h3 class="text-lg sm:text-xl font-semibold text-red-600 mb-2" data-i18n="confirmRemovePinnedRouteTitle">Remove Pinned Route</h3>
                <p class="text-sm sm:text-base text-gray-700 mb-3 sm:mb-4" data-i18n="confirmRemovePinnedRouteDescription">
                    Are you sure you want to remove this pinned route? This action cannot be undone.
                </p>
                <div id="removePinnedRouteDetails" class="bg-gray-50 border border-gray-200 rounded-lg p-3 mb-4">
                    <!-- Route details will be populated here -->
                </div>
            </div>
            
            <div class="flex space-x-3">
                <button onclick="BusTrackingHandler.closeRemovePinnedRouteModal()" 
                        class="flex-1 bg-gray-500 text-white py-2 rounded-lg hover:bg-gray-600 transition duration-300"
                        data-umami-event="cancel-remove-pinned-route">
                    <span data-i18n="cancelButton">Cancel</span>
                </button>
                <button onclick="BusTrackingHandler.confirmRemovePinnedRoute()" 
                        class="flex-1 bg-red-500 text-white py-2 rounded-lg hover:bg-red-600 transition duration-300"
                        data-umami-event="confirm-remove-pinned-route">
                    <i class="fas fa-trash mr-2"></i>
                    <span data-i18n="removeButton">Remove</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Email Verification Modal -->
    <div id="emailVerificationModal" class="fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center hidden p-4">
        <div class="bg-white rounded-lg p-4 sm:p-6 w-full max-w-sm sm:max-w-md mx-auto relative max-h-[90vh] overflow-y-auto">
            <button id="closeEmailVerificationModal" class="text-gray-600 w-full text-right hover:text-gray-800 transition duration-300 ease-in-out mb-2">
                <i class="fas fa-times text-xl text-right"></i>
            </button>
            
            <div class="text-center mb-4 sm:mb-6">
                <i class="fas fa-envelope text-3xl sm:text-4xl text-blue-500 mb-3 sm:mb-4"></i>
                <h3 class="text-lg sm:text-xl font-semibold text-green-600 mb-2" data-i18n="verifySubscriptionTitle">Verify Subscription</h3>
                <p class="text-sm sm:text-base text-gray-700 mb-3 sm:mb-4" data-i18n="verifySubscriptionDescription">
                    Enter the email address associated with your subscription to activate premium features.
                </p>
            </div>
            
            <div class="space-y-3 sm:space-y-4">
                <div>
                    <input type="email" id="verificationEmail" 
                           placeholder="Enter your subscription email" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                           data-i18n-placeholder="emailPlaceholder"
                           oninput="clearVerificationError()">
                </div>
                
                <!-- Error Message -->
                <div id="verificationError" class="hidden bg-red-50 border border-red-200 text-red-700 px-3 py-2 rounded text-sm"></div>
                
                <button onclick="verifyExistingSubscription()" 
                        class="w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 transition duration-300"
                        data-umami-event="verify-subscription">
                    <span data-i18n="verifyButton">Verify Subscription</span>
                </button>
                
                <!-- Subscription Delay Warning -->
                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 mt-4">
                    <div class="flex items-start">
                        <i class="fas fa-clock text-yellow-600 mt-0.5 mr-2"></i>
                        <p class="text-sm text-yellow-800" data-i18n="subscriptionDelayWarning">
                            Subscriptions may take up to 24 hours to take effect. If you just subscribed, please try again later.
                        </p>
                    </div>
                </div>
                
                <div class="text-center mt-4">
                    <p class="text-sm text-gray-600 mb-2" data-i18n="verificationHelp">Think this is a mistake?</p>
                    <a href="mailto:info@saomiguelbus.com" 
                       class="text-blue-500 hover:text-blue-700 text-sm underline"
                       data-umami-event="contact-support">
                        <span data-i18n="contactSupport">Contact us at info@saomiguelbus.com</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Pesquisar Page -->
          <section id="home" class="page active bg-white flex flex-col items-center p-2 h-full overflow-y-auto">       
          <!-- Active Tracking Section (Above Search Form) -->
          <div id="activeTrackingSection" class="container mx-auto px-4 mb-4 max-w-md" style="display: none;">
              <div class="bg-white rounded-lg shadow-md border border-gray-200 p-3">
                  <!-- Top Row: Premium Badge (left) and Count/Toggle (right) -->
                  <div class="flex items-center justify-between mb-3">
                      <!-- Premium Badge on the left -->
                      <span class="bg-gradient-to-r from-yellow-400 to-orange-500 text-white text-xs font-bold px-2 py-0.5 rounded-full flex items-center">
                          <i class="fas fa-crown mr-1 text-xs"></i>
                          <span data-i18n="premium">PREMIUM</span>
                      </span>
                      
                      <!-- Route Count and Toggle on the right -->
                      <div class="flex items-center space-x-2">
                          <span id="activeTrackingCount" class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-semibold" data-i18n="trackingCount">0 routes</span>
                          <div class="bg-gray-100 rounded-full p-1.5 cursor-pointer" onclick="toggleActiveTrackingSection()" data-umami-event="toggle-active-tracking">
                              <i id="activeTrackingToggleIcon" class="fas fa-chevron-down transition-transform duration-300 text-gray-600 text-sm"></i>
                          </div>
                      </div>
                  </div>
                  
                  <!-- Main Content Row: Icon, Title, and Subtitle -->
                  <div class="flex items-center mb-2 cursor-pointer" onclick="toggleActiveTrackingSection()" data-umami-event="toggle-active-tracking">
                      <div class="bg-green-500 rounded-full p-1.5 mr-3">
                          <i class="fas fa-location-arrow text-white text-sm"></i>
                      </div>
                      <div class="flex-1 min-w-0">
                          <h3 class="text-base font-bold text-gray-800 truncate" data-i18n="activeTracking">Active Tracking</h3>
                          <p class="text-xs text-gray-600 truncate" data-i18n="activeTrackingSubtitle">Track your bus routes</p>
                      </div>
                  </div>
                  
                  <div id="activeTrackingList" class="space-y-2 max-h-0 overflow-y-auto transition-all duration-300">
                      <!-- Active tracking items populated here -->
                  </div>
              </div>
          </div>

          <!-- Pinned Routes Section (Above Search Form) -->
          <div id="pinnedRoutesSection" class="container mx-auto px-4 mb-4 max-w-md" style="display: none;">
              <div class="bg-white rounded-lg shadow-md border border-gray-200 p-3">
                  <!-- Top Row: Premium Badge (left) and Count/Toggle (right) -->
                  <div class="flex items-center justify-between mb-3">
                      <!-- Premium Badge on the left -->
                      <span class="bg-gradient-to-r from-yellow-400 to-orange-500 text-white text-xs font-bold px-2 py-0.5 rounded-full flex items-center">
                          <i class="fas fa-crown mr-1 text-xs"></i>
                          <span data-i18n="premium">PREMIUM</span>
                      </span>
                      
                      <!-- Route Count and Toggle on the right -->
                      <div class="flex items-center space-x-2">
                          <span id="pinnedRoutesCount" class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs font-semibold" data-i18n="pinnedCount">0 pinned</span>
                          <div class="bg-gray-100 rounded-full p-1.5 cursor-pointer" onclick="togglePinnedRoutesSection()" data-umami-event="toggle-pinned-routes">
                              <i id="pinnedRoutesToggleIcon" class="fas fa-chevron-down transition-transform duration-300 text-gray-600 text-sm"></i>
                          </div>
                      </div>
                  </div>
                  
                  <!-- Main Content Row: Icon, Title, and Subtitle -->
                  <div class="flex items-center mb-2 cursor-pointer" onclick="togglePinnedRoutesSection()" data-umami-event="toggle-pinned-routes">
                      <div class="bg-blue-500 rounded-full p-1.5 mr-3">
                          <i class="fas fa-thumbtack text-white text-sm"></i>
                      </div>
                      <div class="flex-1 min-w-0">
                          <h3 class="text-base font-bold text-gray-800 truncate" data-i18n="pinnedRoutes">My Daily Routes</h3>
                          <p class="text-xs text-gray-600 truncate" data-i18n="pinnedRoutesSubtitle">Your favorite routes</p>
                      </div>
                  </div>
                  
                  <div id="pinnedRoutesList" class="space-y-2 max-h-0 overflow-y-auto transition-all duration-300">
                      <!-- Pinned routes populated here -->
                  </div>
              </div>
          </div>

          <!-- Premium Feature Request Button -->
          <div id="premiumFeatureRequestSection" class="container mx-auto px-4 mb-2 max-w-md" style="display: none;">
              <div class="text-center">
                  <button onclick="openFeatureRequestEmail()" class="bg-gray-100 hover:bg-gray-200 text-gray-700 text-xs px-3 py-1 rounded-full border border-gray-300 transition duration-200" data-umami-event="feature-request-button">
                      <i class="fas fa-crown text-yellow-500 mr-1"></i>
                      <span data-i18n="askForNewFeatures">Ask for new features / changes to the app</span>
                  </button>
              </div>
          </div>

        <div class="w-full max-w-md mx-auto bg-white rounded-3xl shadow-lg overflow-hidden relative">
            <!-- Ad Banner for Non-Premium Users -->
            <div id="homeAdBanner" class="ad-banner">
                <span class="absolute top-0 left-0 bg-green-500 text-white text-xs font-bold px-2 py-1 rounded-tl-lg rounded-br-lg">AD</span>          
                <a href="#" class="block" onclick="showPricingModal(); return false;" data-umami-event="remove-ads-banner-click">
                    <div id="homeAdContent" class="text-white p-3 text-center">
                        <!-- Dynamic content will be inserted here -->
                    </div>
                </a>
            </div>

            <!-- Search Form -->
            <form action="index.html" method="get" class="p-2" role="search" aria-label="Formulário de Pesquisa de Autocarros">
                <div class="space-y-1">
                    <div class="relative w-full">
                        <input name="origin" id="origin" type="text" placeholder="Origem" class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-green-500" data-i18n-placeholder="originPlaceholder" required autocomplete="off" data-umami-event="input-origin">
                        <div id="origin-suggestions" style="display: none;" class="absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-24 overflow-y-auto"></div>
                        <svg class="absolute left-3 top-2.5 h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                    </div>                   
                
                    <!-- Swap Button -->
                    <button type="button" class="w-full flex justify-end items-center" onclick="swapOriginDestination()" data-umami-event="swap-origin-destination">
                        <div class="bg-green-500 rounded-full w-8 h-8 flex items-center justify-center hover:bg-green-600 transition duration-300 ease-in-out">
                            <i id="swapIcon" class="fas fa-exchange-alt transform rotate-90 text-white text-sm"></i>
                        </div>
                    </button>

                    <div class="relative w-full">
                        <input name="destination" id="destination" type="text" placeholder="Destino" class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-green-500" data-i18n-placeholder="destinationPlaceholder" required autocomplete="off" data-umami-event="input-destination">
                        <div id="destination-suggestions" style="display: none;"  class="absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-24 overflow-y-auto"></div>
                        <svg class="absolute left-3 top-2.5 h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                    </div>

                    <br>

                    <!-- Date and Time Picker Container -->
                    <div class="flex flex-row space-x-4 w-full max-w-md">
                        <!-- Date Picker Input -->
                        <div class="relative flex-1">
                            <input 
                                type="date" 
                                id="datePicker" 
                                name="date" 
                                class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-green-500 bg-white appearance-none"
                                style="-webkit-appearance: none; -moz-appearance: none; appearance: none;" 
                                data-i18n="dayLabel" 
                                onchange="checkDayType()"
                                data-umami-event="input-date"
                            >
                            <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none">
                                <i class="fas fa-calendar-alt"></i>
                            </span>
                        </div>
    
                        <!-- Time Picker Input -->
                        <div class="relative flex-1">
                            <input 
                                type="time" 
                                id="time" 
                                name="time" 
                                class="w-full pl-10 pr-4 py-2 h-10 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-green-500 bg-white appearance-none" 
                                style="-webkit-appearance: none; -moz-appearance: none; appearance: none;" 
                                data-i18n-placeholder="timePlaceholder" 
                                required
                                data-umami-event="input-time"
                            >
                            <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none">
                                <i class="fas fa-clock"></i>
                            </span>
                        </div>
                    </div>

                    <div class="flex space-x-2">
                        <button type="submit" id="btnSubmit" class="flex-grow bg-green-500 text-white py-2 rounded-full hover:bg-green-600 transition duration-300 ease-in-out" data-i18n="searchButton" data-umami-event="search-button">
                            Pesquisar
                        </button>
                        <button type="button" id="btnRoutes" class="bg-green-500 text-white p-2 rounded-full hover:bg-green-600 transition duration-300 ease-in-out w-10 h-10 flex items-center justify-center" data-umami-event="routes-button" data-offline="false">
                            <i class="fas fa-route"></i>
                        </button>
                    </div>
                </div>
            </form>
        </div>
        <div class="tm-container-outer max-w-md mx-auto" id="routesDiv">      
            <!-- Placeholder for No Routes Message -->
            <div id="noRoutesMessage" class="hidden text-center text-lg text-gray-700 mt-4" data-i18n="noRoutesMessage">
                Nenhuma rota encontrada. Tente novamente com diferentes parâmetros.
            </div>

            <!-- Placeholder for Routes -->
            <div id="routesContainer" class="hidden mt-4">
                <!-- Routes will be added dynamically -->
            </div>     
            
            <!-- Placeholder for favourite Routes -->
            <div id="favouriteRoutesContainer" class="hidden mt-4">
                <!-- Favourite Routes will be added dynamically -->
            </div>
        </div>

        <!-- Bus Tracking Widget (can be used for future features) -->
        <div id="busTrackingWidget" class="container mx-auto px-4 mb-4 hidden max-w-md">
            <!-- Future bus tracking features can be added here -->
        </div>

        <!-- Instructional Card for Home Section -->
        <div id="homeInstructionCard" class="bg-white border-l-4 border-blue-500 text-blue-700 p-4 rounded-lg shadow-md mb-6 mt-4 sm:block max-w-md mx-auto">
            <div class="flex items-center mb-3">
                <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <span class="font-semibold mr-4 text-lg sm:text-xl" data-i18n="homeInstructionsTitle">Instruções de Uso</span>
                <i class="fas fa-bus text-xl sm:text-2xl"></i>
            </div>
            <p class="mb-3 text-sm sm:text-base" data-i18n="homeInstructionsText">Insira sua origem e destino acima para procurar as rotas disponíveis.</p>
            <div class="bg-blue-50 border-l-4 border-blue-300 p-2 rounded text-sm sm:text-base">
                <div class="flex items-center">
                    <i class="fas fa-route bg-green-500 text-white p-1 rounded-full w-6 h-6 mr-2"></i>
                    <span data-i18n="homeInstructionsText2">Clique no botão de rota acima se pretender obter direções passo a passo.</span>
                </div>
            </div>
        </div>

        <!-- Install App Buttons -->
        <div id="installAppButtons" class="w-full max-w-md mx-auto mt-4">
            <button id="installAndroidApp" class="hidden w-full bg-green-500 text-white py-2 px-4 rounded-full hover:bg-green-600 transition duration-300 ease-in-out mb-2" onclick="window.location.href='https://play.google.com/store/apps/details?id=com.hsousa_apps.Autocarros'" data-umami-event="install-android-app">
                <div class="flex items-center"></div>
                    <i class="fab fa-android mr-2 self-center text-xl"></i>
                    <span data-i18n="installAndroidApp" class="flex-grow">Install Android App</span>
                </div>
            </button>
            <button id="installIOSApp" class="hidden w-full bg-black text-white py-2 px-4 rounded-full hover:bg-blue-600 transition duration-300 ease-in-out" onclick="window.location.href='/newsletter'" data-umami-event="install-ios-app">
                <div class="flex items-center">
                    <i class="fab fa-apple mr-2 self-center text-xl"></i>
                    <span data-i18n="registerToDownloadIOSApp" class="flex-grow text-sm">Register to Download iOS App</span>
                </div>
            </button>
        </div>

    </section>

    <!-- Routes Page -->
    <section id="routes" class="page hidden bg-white flex flex-col items-center p-2 h-full overflow-y-auto">
        <div class="w-full max-w-md mx-auto bg-white rounded-3xl shadow-lg overflow-hidden relative">
            <!-- Ad Banner for Non-Premium Users -->
            <div id="routesAdBanner" class="ad-banner">
                <span class="absolute top-0 left-0 bg-green-500 text-white text-xs font-bold px-2 py-1 rounded-tl-lg rounded-br-lg">AD</span>          
                <a href="#" class="block" onclick="showPricingModal(); return false;" data-umami-event="remove-ads-banner-click-routes">
                    <div id="routesAdContent" class="text-white p-3 text-center">
                        <!-- Dynamic content will be inserted here -->
                    </div>
                </a>
            </div>

            <!-- Search Form -->
            <form action="index.html" method="get" class="p-2" role="search" aria-label="Formulário de Pesquisa de Autocarros">
                <div class="space-y-1">
                    <div class="relative w-full">
                        <input name="originStepByStep" id="originStepByStep" type="text" placeholder="Origem" class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-green-500" data-i18n-placeholder="originPlaceholder" required autocomplete="off" data-umami-event="input-origin-step-by-step">
                        <div id="originStepByStep-suggestions" style="display: none;"  class="absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-24 overflow-y-auto"></div>
                        <svg class="absolute left-3 top-2.5 h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                    </div>
                
                    <!-- Swap Button -->
                    <button type="button" class="w-full flex justify-end items-center" onclick="swapOriginDestination()" data-umami-event="swap-origin-destination-step-by-step">
                        <div class="bg-green-500 rounded-full w-8 h-8 flex items-center justify-center hover:bg-green-600 transition duration-300 ease-in-out">
                            <i id="swapIconStepByStep" class="fas fa-exchange-alt transform rotate-90 text-white text-sm"></i>
                        </div>
                    </button>

                    <div class="relative w-full">
                        <input name="destinationStepByStep" id="destinationStepByStep" type="text" placeholder="Destino" class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-green-500" data-i18n-placeholder="destinationPlaceholder" required autocomplete="off" data-umami-event="input-destination-step-by-step">
                        <div id="destinationStepByStep-suggestions" style="display: none;" class="absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-24 overflow-y-auto"></div>
                        <svg class="absolute left-3 top-2.5 h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                    </div>
                    <br>

                    <!-- Date and Time Picker Container -->
                    <div class="flex flex-row space-x-4 w-full max-w-md">
                        <!-- Date Picker Input -->
                        <div class="relative flex-1">
                            <input 
                                type="date" 
                                id="datePickerStepByStep" 
                                name="date" 
                                class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-green-500 bg-white appearance-none"
                                style="-webkit-appearance: none; -moz-appearance: none; appearance: none;" 
                                data-i18n="dayLabel" 
                                onchange="checkDayType()"
                                data-umami-event="select-date-step-by-step"
                            >
                            <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none">
                                <i class="fas fa-calendar-alt"></i>
                            </span>
                        </div>
    
                        <!-- Time Picker Input -->
                        <div class="relative flex-1">
                            <input 
                                type="time" 
                                id="timeStepByStep" 
                                name="time" 
                                class="w-full pl-10 pr-4 py-2 h-10 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-green-500 bg-white appearance-none" 
                                style="-webkit-appearance: none; -moz-appearance: none; appearance: none;" 
                                data-i18n-placeholder="timePlaceholder" 
                                required
                                data-umami-event="select-time-step-by-step"
                            >
                            <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none">
                                <i class="fas fa-clock"></i>
                            </span>
                        </div>
                    </div>

                    <div class="flex space-x-2">
                        <button type="submit" id="btnSubmitStepByStep" class="flex-grow bg-green-500 text-white py-2 rounded-full hover:bg-green-600 transition duration-300 ease-in-out" data-i18n="directionsButton" data-umami-event="submit-step-by-step">
                            Obter Direções
                        </button>
                        <button type="button" id="btnRoutesStepByStep" class="bg-green-500 text-white p-2 rounded-full hover:bg-green-600 transition duration-300 ease-in-out w-10 h-10 flex items-center justify-center" data-umami-event="view-routes-step-by-step">
                            <i class="fas fa-bus"></i>
                        </button>
                    </div>
                </div>
            </form>
        </div>
        <div id="directionsContainer"></div>
        
        <!-- Instructional Card for Routes Section -->
        <div id="routesInstructionCard" class="bg-white border-l-4 border-blue-500 text-blue-700 p-4 rounded-lg shadow-md mb-6 mt-4 sm:block max-w-md mx-auto" data-umami-event="view-routes-instructions">
            <div class="flex items-center mb-3">
                <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <span class="font-semibold mr-4 text-lg sm:text-xl" data-i18n="routeInstructionsTitle">Instruções de Uso</span>
                <i class="fas fa-route text-xl sm:text-2xl"></i>
            </div>
            <p class="mb-3 text-sm sm:text-base" data-i18n="routeInstructionsText">Insira um local de origem e de destino para receber detalhes e direções passo a passo.</p>
            <div class="bg-blue-50 border-l-4 border-blue-300 p-2 rounded text-sm sm:text-base">
                <div class="flex items-center">
                    <i class="fas fa-bus bg-green-500 text-white p-1 rounded-full w-6 h-6 mr-2"></i>
                    <span data-i18n="routeInstructionsText2">Clique no botão do autocarro acima se pretender apenas procurar rotas de autocarros disponíveis.</span>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Tours Page -->
    <section id="tours" class="page hidden bg-white flex flex-col items-center p-2" data-umami-event="view-tours-page">
        <h2 class="text-2xl text-center font-bold mb-4" data-i18n="toursTitle">Tours</h2>
        <p class="text-center text-lg mb-6" data-i18n="toursSubtitle">Encontre tours turísticos na ilha de São Miguel.</p>
        
        <!-- Ad Banner in Tours Section -->
        <div id="toursAdBanner" class="ad-banner mb-4 max-w-md mx-auto">
            <span class="absolute top-0 left-0 bg-green-500 text-white text-xs font-bold px-2 py-1 rounded-tl-lg rounded-br-lg">AD</span>          
            <a href="#" class="block" onclick="showPricingModal(); return false;" data-umami-event="remove-ads-tours-banner">
                <div class="bg-gradient-to-r from-blue-400 to-indigo-500 text-white p-3 text-center rounded-lg">
                    <div class="flex items-center justify-center mb-1">
                        <i class="fas fa-gem text-xl mr-2"></i>
                        <p class="font-bold text-lg" data-i18n="premiumExperienceTitle">PREMIUM EXPERIENCE</p>
                    </div>
                    <p class="text-sm opacity-90">
                        <span data-i18n="noAdsExperienceText">Browse tours without ads - Upgrade now!</span>
                    </p>
                </div>
            </a>
        </div>
        
        <div id="viatorWidget"></div>
        
        <!-- Loading Info Section -->
        <div id="loadingToursInfo" class="bg-white rounded-lg p-4 shadow-md mb-6 max-w-md mx-auto" data-umami-event="view-loading-tours-info">
            <h3 class="text-xl font-semibold mb-3 text-center" data-i18n="loadingToursInfoTitle">Carregando Informações</h3>
            <p class="text-gray-700 text-center mb-4" data-i18n="loadingToursInfoDescription">
                Por favor, aguarde enquanto carregamos as informações dos tours disponíveis.
            </p>
            <div class="flex justify-center mb-4">
                <div class="animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-green-500"></div>
            </div>
            <p class="text-sm text-gray-600 text-center" data-i18n="loadingToursAlternativeLink">
                Se demorar muito a carregar pode também aceder através deste link: 
            </p>
        </div>
        <div class="flex justify-center">
            <a href="https://www.viator.com/?pid=P00222801&mcid=42383&medium=link&medium_version=selector&campaign=sao-miguel-tours" target="_blank" class="text-blue-500 hover:underline" data-umami-event="view-viator-website">São Miguel Tours <i class="fas fa-external-link-alt text-xs ml-1"></i></a>
        </div>
    </section>

    <!-- Advert Page - Now Premium Subscription Page -->
    <section id="advert" class="page hidden bg-white flex flex-col items-center p-4" data-umami-event="view-premium-page">
        <!-- Content for users WITHOUT premium (ads active) -->
        <div id="premiumSubscriptionContent" class="w-full max-w-md mx-auto">
            <div class="text-center mb-6">
                <i class="fas fa-crown text-5xl text-yellow-500 mb-4"></i>
                <h2 class="text-2xl font-bold mb-2" data-i18n="getPremiumTitle">Get Premium</h2>
                <p class="text-gray-700 mb-4" data-i18n="premiumDescription">
                    Unlock advanced bus tracking features and enjoy an ad-free experience
                </p>
                <p class="text-sm text-green-600 font-medium" data-i18n="supportDeveloper">
                    Bonus: Support an Azorean Solo Developer. (Yes, this app is not developed by any company, it is just one guy)
                </p>
            </div>
            
            <!-- Pricing Options -->
            <div class="space-y-3 mb-6">
                <div id="premium-page-weekly" class="pricing-option border-2 border-gray-200 bg-white rounded-lg p-4 cursor-pointer hover:border-green-300 transition-colors" onclick="selectPricingOptionPage('weekly')" data-umami-event="select-pricing-page-weekly">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="w-4 h-4 border-2 border-gray-300 rounded-full mr-3"></div>
                            <div>
                                <div class="font-semibold text-lg">€0.50<span class="text-sm text-gray-500" data-i18n="perWeek">/week</span></div>
                                <div class="text-sm text-gray-600" data-i18n="weeklyDescription">Perfect for tourists</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="premium-page-monthly" class="pricing-option border-2 border-gray-200 bg-white rounded-lg p-4 cursor-pointer hover:border-green-300 transition-colors" onclick="selectPricingOptionPage('monthly')" data-umami-event="select-pricing-page-monthly">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="w-4 h-4 border-2 border-gray-300 rounded-full mr-3"></div>
                            <div>
                                <div class="font-semibold text-lg">€1.99<span class="text-sm text-gray-500" data-i18n="perMonth">/month</span></div>
                                <div class="text-sm text-gray-600" data-i18n="monthlyDescription">Most popular</div>
                            </div>
                        </div>
                        <div class="bg-blue-500 text-white text-xs font-bold px-2 py-1 rounded-full">
                            <span data-i18n="freeTrialBadge">14-day free trial</span>
                        </div>
                    </div>
                </div>
                
                <div id="premium-page-yearly" class="pricing-option border-2 border-gray-200 bg-white rounded-lg p-4 cursor-pointer hover:border-green-300 transition-colors" onclick="selectPricingOptionPage('yearly')" data-umami-event="select-pricing-page-yearly">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="w-4 h-4 border-2 border-gray-300 rounded-full mr-3"></div>
                            <div>
                                <div class="font-semibold text-lg">€19.99<span class="text-sm text-gray-500" data-i18n="perYear">/year</span></div>
                                <div class="text-sm text-gray-600" data-i18n="yearlyDescription">Save 17%</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Subscribe Button -->
            <button onclick="subscribeToSelectedPlanPage()" 
                    id="subscribeButtonPage"
                    class="w-full bg-green-500 text-white py-3 rounded-lg hover:bg-green-600 transition duration-300 mb-4"
                    data-umami-event="subscribe-premium-page">
                <i class="fas fa-crown mr-2"></i>
                <span id="subscribeButtonTextPage" data-i18n="getPremiumButton">Get Premium</span>
            </button>
            
            <!-- Already Subscribed Link -->
            <div class="text-center mb-6">
                <button onclick="showEmailVerificationModal()" 
                        class="text-blue-500 hover:text-blue-700 text-sm underline"
                        data-umami-event="already-subscribed-page">
                    <span data-i18n="alreadySubscribed">I already have a subscription enabled</span>
                </button>
            </div>
            
            <!-- Premium Features -->
            <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
                <h4 class="font-semibold text-green-800 mb-3" data-i18n="premiumFeaturesTitle">Premium Features:</h4>
                <ul class="text-sm text-green-700 space-y-2">
                    <li class="flex items-start">
                        <i class="fas fa-location-arrow text-green-500 mr-2 mt-0.5 flex-shrink-0"></i>
                        <span data-i18n="premiumFeatureBusTracking">Real-time bus tracking and arrival estimates</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-thumbtack text-green-500 mr-2 mt-0.5 flex-shrink-0"></i>
                        <span data-i18n="premiumFeaturePinnedRoutes">Pin favorite routes for daily tracking</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-ad text-green-500 mr-2 mt-0.5 flex-shrink-0"></i>
                        <span data-i18n="premiumFeature1">No advertisements</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-headset text-green-500 mr-2 mt-0.5 flex-shrink-0"></i>
                        <span data-i18n="premiumFeature2">Priority support</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-star text-green-500 mr-2 mt-0.5 flex-shrink-0"></i>
                        <span data-i18n="premiumFeature3">Early access to new features</span>
                    </li>
                </ul>
            </div>
            
            <p class="text-xs text-gray-500 text-center" data-i18n="premiumTerms">
                By subscribing, you agree to our Terms of Service and Privacy Policy.
            </p>
        </div>
        
        <!-- Content for users WITH premium (ads removed) -->
        <div id="premiumThankYouContent" class="w-full max-w-md mx-auto hidden">
            <div class="text-center mb-6">
                <i class="fas fa-heart text-5xl text-red-500 mb-4"></i>
                <h2 class="text-2xl font-bold mb-2" data-i18n="thankYouTitle">Thank You!</h2>
                <p class="text-gray-700 mb-4" data-i18n="thankYouDescription">
                    You're enjoying an ad-free experience and supporting the development of São Miguel Bus.
                </p>
            </div>
            
            <!-- Premium Status Card -->
            <div class="bg-gradient-to-r from-yellow-400 to-orange-500 text-white rounded-lg p-4 mb-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <i class="fas fa-crown text-2xl mr-3"></i>
                        <div>
                            <h3 class="font-semibold" data-i18n="premiumActive">Premium Active</h3>
                            <!-- <p class="text-sm opacity-90" data-i18n="premiumExpires">Expires: <span id="premiumExpiryDatePage"></span></p> -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Manage Subscription Card -->
            <div class="bg-white border border-blue-200 rounded-lg p-4 mb-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <i class="fas fa-cog text-2xl mr-3 text-blue-500"></i>
                        <div>
                            <h3 class="font-semibold text-gray-800" data-i18n="manageSubscriptionTitle">Manage Subscription</h3>
                            <p class="text-sm text-gray-600" data-i18n="manageSubscriptionDescription">Update payment method, view invoices, or cancel subscription</p>
                        </div>
                    </div>
                    <a href="https://billing.stripe.com/p/login/3cIaEW8jJ3UR4hvbeFgUM00" target="_blank" 
                       class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition duration-300 text-sm"
                       data-umami-event="manage-subscription-ads-page">
                        <span data-i18n="manageButton">Manage</span>
                    </a>
                </div>
            </div>
            
            <!-- Cancel Subscription Card -->
            <div class="bg-white border border-gray-200 rounded-lg p-4 mb-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <i class="fas fa-credit-card text-2xl mr-3 text-red-500"></i>
                        <div>
                            <h3 class="font-semibold text-gray-800" data-i18n="cancelSubscriptionTitle">Cancel Subscription</h3>
                            <p class="text-sm text-gray-600" data-i18n="cancelSubscriptionDescription">Manage or cancel your premium subscription</p>
                        </div>
                    </div>
                    <a href="https://billing.stripe.com/p/login/3cIaEW8jJ3UR4hvbeFgUM00" target="_blank" 
                       class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition duration-300 text-sm"
                       data-umami-event="cancel-subscription-page">
                        <span data-i18n="cancelSubscriptionButton">Cancel</span>
                    </a>
                </div>
            </div>
            
            <!-- Premium Account Email Display -->
            <div class="bg-white border border-gray-200 rounded-lg p-4 mb-4">
                <div class="flex items-center">
                    <i class="fas fa-envelope text-2xl mr-3 text-gray-500"></i>
                    <div class="flex-1">
                        <h3 class="font-semibold text-gray-800" data-i18n="premiumAccountEmail">Premium Account Email</h3>
                        <p class="text-sm text-gray-600 break-all" id="premiumAccountEmailDisplay">
                            <!-- Email will be populated here by JavaScript -->
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Support Message -->
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                <h4 class="font-semibold text-blue-800 mb-2" data-i18n="supportMessageTitle">Your Support Matters</h4>
                <p class="text-sm text-blue-700" data-i18n="supportMessageDescription">
                    Thank you for supporting an independent developer. Your subscription helps keep São Miguel Bus free for everyone and enables continuous improvements.
                </p>
            </div>
        </div>
    </section>

    <!-- Info Page -->
    <section id="info" class="page hidden bg-white min-h-screen flex flex-col items-center p-4" data-umami-event="view-info-page">
        <div class="w-full max-w-md mx-auto">
            <!-- Language Selection Button -->
            <button id="languageButton" class="bg-white w-auto text-green-600 py-2 px-4 rounded-full shadow-md hover:bg-green-50 transition duration-300 ease-in-out flex items-center border border-green-500 mb-2 float-right" data-umami-event="select-language">
                <span id="currentLanguage" class="mr-2 text-xl" data-i18n="currentLanguage">🇵🇹</span>
                <i class="fas fa-chevron-down ml-2 text-green-500"></i>
            </button>
            <br><br><br>
            <div class="bg-gray-100 rounded-lg p-4 mb-4 flex items-center">
                <img src="static/img/logo.png" alt="Logo" class="w-8 h-8 mr-4">
                <div><h3 class="font-semibold" data-i18n="infoDevelopedBy">Esta aplicação foi desenvolvida por</h3> <a href="https://www.sousadev.com" target="_blank" class="text-blue-500">Sousa Dev</a></div>
            </div>

            <!-- Premium Status Card (shown when premium is active) -->
            <div id="premiumStatusCard" class="hidden bg-gradient-to-r from-yellow-400 to-orange-500 text-white rounded-lg p-4 mb-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <i class="fas fa-crown text-2xl mr-3"></i>
                        <div>
                            <h3 class="font-semibold" data-i18n="premiumActive">Premium Active</h3>
                            <!-- <p class="text-sm opacity-90" data-i18n="premiumExpires">Expires: <span id="premiumExpiryDate"></span></p> -->
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <a href="https://billing.stripe.com/p/login/3cIaEW8jJ3UR4hvbeFgUM00" target="_blank" 
                           class="text-white hover:text-gray-200 text-sm underline"
                           data-umami-event="manage-subscription">
                            <span data-i18n="manageSubscription">Manage</span>
                        </a>
                        <button onclick="deactivatePremium()" class="text-white hover:text-gray-200" data-umami-event="deactivate-premium">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Cancel Subscription Card (shown when premium is active)
            <div id="cancelSubscriptionCard" class="hidden bg-white border border-gray-200 rounded-lg p-4 mb-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <i class="fas fa-credit-card text-2xl mr-3 text-red-500"></i>
                        <div>
                            <h3 class="font-semibold text-gray-800" data-i18n="cancelSubscriptionTitle">Cancel Subscription</h3>
                            <p class="text-sm text-gray-600" data-i18n="cancelSubscriptionDescription">Manage or cancel your premium subscription</p>
                        </div>
                    </div>
                    <a href="https://billing.stripe.com/p/login/3cIaEW8jJ3UR4hvbeFgUM00" target="_blank" 
                       class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition duration-300 text-sm"
                       data-umami-event="cancel-subscription">
                        <span data-i18n="cancelSubscriptionButton">Cancel</span>
                    </a>
                </div>
            </div> -->

            <!-- Premium Button (shown when premium is not active) -->
            <a href="#" id="premiumButton" class="block bg-white border border-gray-200 rounded-lg p-4 mb-4 flex items-center justify-between hover:bg-gray-50" 
               onclick="showPricingModal();" data-umami-event="view-premium-modal">
                <div class="flex items-center">
                    <i class="fas fa-crown text-3xl mr-4 text-yellow-500"></i>
                    <h3 class="font-semibold" data-i18n="getPremiumTitle">Get Premium</h3>
                </div>
                <span class="iconify" data-icon="mdi:chevron-right"></span>
            </a>

            <!-- Manage Subscription Button (shown when premium is active) -->
            <!-- <a href="https://billing.stripe.com/p/login/3cIaEW8jJ3UR4hvbeFgUM00" target="_blank" 
               id="manageSubscriptionButton" class="hidden block bg-white border border-gray-200 rounded-lg p-4 mb-4 flex items-center justify-between hover:bg-gray-50" 
               data-umami-event="manage-subscription-info">
                <div class="flex items-center">
                    <i class="fas fa-cog text-3xl mr-4 text-blue-500"></i>
                    <h3 class="font-semibold" data-i18n="manageSubscriptionTitle">Manage Subscription</h3>
                </div>
                <span class="iconify" data-icon="mdi:chevron-right"></span>
            </a> -->

            <a href="#" class="block bg-white border border-gray-200 rounded-lg p-4 mb-4 flex items-center justify-between hover:bg-gray-50" onclick="document.getElementById('infoModal').classList.remove('hidden');" data-umami-event="view-info-modal">
                <div class="flex items-center">
                    <span class="iconify text-3xl mr-4" data-icon="mdi:information-outline"></span>
                    <h3 class="font-semibold" data-i18n="infoNotDevelopedByBusCompanies">Aplicação não Desenvolvida pelas Empresas de Autocarros</h3>
                </div>
                <span class="iconify" data-icon="mdi:chevron-right"></span>
            </a>
            <div id="infoModal" class="fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center hidden" onclick="document.getElementById('infoModal').classList.add('hidden');" data-umami-event="close-info-modal">
                <div class="bg-white rounded-lg p-6 w-80 relative" onclick="event.stopPropagation();">
                    <button id="closeInfoModal" class="text-gray-600 w-full text-right hover:text-gray-800 transition duration-300 ease-in-out mb-2" onclick="document.getElementById('infoModal').classList.add('hidden');" data-umami-event="close-info-modal-button">
                        <i class="fas fa-times text-xl text-right"></i>
                    </button>
                    <h3 class="text-xl font-semibold text-green-600 mb-3" data-i18n="infoModalTitle">Informações Importantes</h3>
                    <p class="text-gray-700 leading-relaxed" data-i18n="infoModalDescription">
                        A aplicação São Miguel Bus foi desenvolvida por apenas uma pessoa, sem qualquer apoio externo ou associação com companhias ou entidades.
                    </p>
                    <p class="text-gray-700 mt-4 italic" data-i18n="infoModalEnd">Os horários são da inteira responsabilidade das empresas de autocarros.</p>
                </div>
            </div>

            <a href="#" class="block bg-white border border-gray-200 rounded-lg p-4 mb-4 flex items-center justify-between hover:bg-gray-50" onclick="document.getElementById('contactCompaniesModal').classList.remove('hidden');" data-umami-event="view-contact-companies-modal">
                <div class="flex items-center">
                    <span class="iconify text-3xl mr-4" data-icon="mdi:bus"></span>
                    <h3 class="font-semibold" data-i18n="contactBusCompanies">Contato das Companhias de Autocarros</h3>
                </div>
                <span class="iconify" data-icon="mdi:chevron-right"></span>
            </a>

            <div id="contactCompaniesModal" class="fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center hidden" onclick="document.getElementById('contactCompaniesModal').classList.add('hidden');" data-umami-event="close-contact-companies-modal">
                <div class="bg-white rounded-lg p-6 w-80 relative" onclick="event.stopPropagation();">
                    <button id="closeContactModal" class="text-gray-600 w-full text-right hover:text-gray-800 transition duration-300 ease-in-out mb-2" onclick="document.getElementById('contactCompaniesModal').classList.add('hidden');" data-umami-event="close-contact-modal-button">
                        <i class="fas fa-times text-xl text-right"></i>
                    </button>
                    <h3 class="text-xl font-semibold text-green-600 mb-3" data-i18n="contactBusCompaniesTitle">Contato das Companhias de Autocarros</h3>
                    <p class="text-gray-700" data-i18n="contactBusCompaniesDescription">Para mais informações, entre em contato com as companhias de autocarros diretamente.</p>
                    <ul class="list-disc list-inside text-gray-700 mt-2 space-y-2">
                        <li>
                            <a href="https://www.facebook.com/autoviacaomicaelensetransportes?locale=pt_PT" target="_blank" class="text-blue-500 hover:underline">Auto Viação Micaelense, Lda. </a>
                            <br>
                            <span class="text-gray-500 text-xs ml-4">Telefone: <a href="tel:+351296301358" class="text-blue-500 hover:underline">296 301 358</a></span>
                            <br>
                            <span class="text-gray-500 text-xs ml-4">Email: <a href="mailto:transportes@autoviacaomicaelense.pt" class="text-blue-500 hover:underline">transportes@autoviacaomicaelense.pt</a></span>
                        </li>
                        <li>
                            <a href="https://www.visitazores.com/en/explore/varela-e-companhia-lda" target="_blank" class="text-blue-500 hover:underline">Varela & Companhia, Lda.</a>
                            <br>
                            <span class="text-gray-500 text-xs ml-4">Telefone: <a href="tel:+351296301800" class="text-blue-500 hover:underline">+351 296 301 800</a></span>
                            <br>
                            <span class="text-gray-500 text-xs ml-4">Email: <a href="mailto:bensaude@bensaude.pt" class="text-blue-500 hover:underline">bensaude@bensaude.pt</a></span>
                        </li>
                        <li>
                            <a href="https://www.crp-caetanoraposopereiras.pt/" target="_blank" class="text-blue-500 hover:underline">Caetano Raposo e Pereiras, Lda.</a>
                            <br>
                            <span class="text-gray-500 text-xs ml-4">Telefone: <a href="tel:+351296304260" class="text-blue-500 hover:underline">+351 296 304 260</a></span>
                            <br>
                            <span class="text-gray-500 text-xs ml-4">Email: <a href="mailto:turismo@crp.com.pt" class="text-blue-500 hover:underline">turismo@crp.com.pt</a></span>
                        </li>
                    </ul>
                </div>
            </div>

            <a href="#" class="block bg-white border border-gray-200 rounded-lg p-4 mb-4 flex items-center justify-between hover:bg-gray-50" onclick="document.getElementById('aluguerModal').classList.remove('hidden');" data-umami-event="view-aluguer-modal">
                <div class="flex items-center">
                    <span class="iconify text-3xl mr-4" data-icon="mdi:bus-clock"></span>
                    <h3 class="font-semibold" data-i18n="aluguerTitle">Aluguer de Autocarros</h3>
                </div>
                <span class="iconify" data-icon="mdi:chevron-right"></span>
            </a>

            <div id="aluguerModal" class="fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center hidden" onclick="document.getElementById('aluguerModal').classList.add('hidden');" data-umami-event="close-aluguer-modal">
                <div class="bg-white rounded-lg p-6 w-80 relative" onclick="event.stopPropagation();">
                    <button id="closeAluguerModal" class="text-gray-600 w-full text-right hover:text-gray-800 transition duration-300 ease-in-out mb-2" onclick="document.getElementById('aluguerModal').classList.add('hidden');" data-umami-event="close-aluguer-modal-button">
                        <i class="fas fa-times text-xl text-right"></i>
                    </button>
                    <h3 class="text-xl font-semibold text-green-600 mb-3" data-i18n="aluguerTitle">Aluguer de Autocarros</h3>
                    <p class="text-gray-700" data-i18n="aluguerDescription">Para mais informações sobre aluguer de autocarros, entre em contato com as companhias de autocarros diretamente.</p>
                </div>
            </div>

            <a href="#" class="block bg-white border border-gray-200 rounded-lg p-4 mb-4 flex items-center justify-between hover:bg-gray-50" onclick="document.getElementById('priceModal').classList.remove('hidden');" data-umami-event="view-price-modal">
                <div class="flex items-center">
                    <span class="iconify text-3xl mr-4" data-icon="mdi:ticket"></span>
                    <h3 class="font-semibold" data-i18n="priceApp">Preço dos Bilhetes</h3>
                </div>
                <span class="iconify" data-icon="mdi:chevron-right"></span>
            </a>

            <div id="priceModal" class="fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center hidden" onclick="document.getElementById('priceModal').classList.add('hidden');" data-umami-event="close-price-modal">
                <div class="bg-white rounded-lg p-6 w-80 relative" onclick="event.stopPropagation();">
                    <button id="closePriceModal" class="text-gray-600 w-full text-right hover:text-gray-800 transition duration-300 ease-in-out mb-2" onclick="document.getElementById('priceModal').classList.add('hidden');" data-umami-event="close-price-modal-button">
                        <i class="fas fa-times text-xl text-right"></i>
                    </button>
                    <h3 class="text-xl font-semibold text-green-600 mb-3" data-i18n="priceApp">Preço dos Bilhetes</h3>
                    <p class="text-gray-700" data-i18n="priceAppDescription">Os preços dos bilhetes são determinados pelas companhias de autocarros e podem variar de acordo com a distância, o tipo de bilhete e outros fatores. Não temos acesso aos preços, mas podemos informar que os bilhetes são vendidos no próprio autocarro e devem ser comprados ao motorista com dinheiro físico ao entrar no autocarro.</p>
                    <p class="text-gray-700 mt-4 italic" data-i18n="priceAppEnd">Para mais informações, entre em contato com as companhias de autocarros diretamente.</p>
                </div>
            </div>

            <a href="#" class="block bg-white border border-gray-200 rounded-lg p-4 mb-4 flex items-center justify-between hover:bg-gray-50" onclick="document.getElementById('infoModalAds').classList.remove('hidden');" data-umami-event="view-info-modal-ads">
                <div class="flex items-center">
                    <span class="text-3xl mr-4"><i class="fas fa-info-circle"></i></span>
                    <h3 class="font-semibold" data-i18n="appMonetizationButton">How does this app work?</h3>
                </div>
                <span class="iconify" data-icon="mdi:chevron-right"></span>
            </a>

            <div id="infoModalAds" class="fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center hidden" onclick="document.getElementById('infoModalAds').classList.add('hidden');" data-umami-event="close-info-modal-ads">
                <div class="bg-white rounded-lg p-6 w-80 relative" onclick="event.stopPropagation();">
                    <button id="closeInfoModalAds" class="text-gray-600 w-full text-right hover:text-gray-800 transition duration-300 ease-in-out mb-2" onclick="document.getElementById('infoModalAds').classList.add('hidden');" data-umami-event="close-info-modal-ads-button">
                        <i class="fas fa-times text-xl text-right"></i>
                    </button>
                    <div class="p-6">
                        <h4 class="text-xl font-semibold text-green-600 mb-3" data-i18n="aboutAdsTitle">Sobre os Anúncios</h4>
                        <p class="text-gray-700 leading-relaxed" data-i18n="aboutAdsParagraph1">
                            A aplicação São Miguel Bus foi desenvolvida por apenas uma pessoa, sem qualquer apoio externo ou associação com companhias ou entidades. Os anúncios desempenham um papel crucial:
                        </p>
                        <ul class="list-disc list-inside text-gray-700 mt-2 space-y-2">
                            <li data-i18n="aboutAdsList1">Ajudam a cobrir os custos do servidor da aplicação</li>
                            <li data-i18n="aboutAdsList2">Permitem manter a aplicação totalmente gratuita para todos os utilizadores</li>
                            <li data-i18n="aboutAdsList3">Contribuem para o contínuo desenvolvimento e melhoria da plataforma</li>
                        </ul>
                        <p class="text-gray-700 mt-4 italic" data-i18n="supportThankYou">
                            Agradecemos a sua compreensão e apoio ao utilizar a São Miguel Bus!
                        </p>
                    </div>
                </div>
            </div>

            <a href="mailto:info@saomiguelbus.com" class="text-blue-500 text-center block mt-4" data-i18n="contactDeveloper" data-umami-event="contact-developer">Contate o Desenvolvedor</a>

            <p class="text-center text-gray-500 mt-8">Copyright © 2024 
                <a href="https://www.sousadev.com" target="_blank" class="text-blue-600" data-umami-event="visit-sousadev">Sousa Dev</a>
            </p>
            <div class="text-center">
                <a href="https://twitter.com/sousadev" target="_blank" class="mx-2" data-umami-event="visit-twitter">
                    <i class="fab fa-twitter text-2xl"></i>
                </a>
                <a href="https://instagram.com/saomiguelbus" target="_blank" class="mx-2" data-umami-event="visit-instagram">
                    <i class="fab fa-instagram text-2xl"></i>
                </a>
                <a href="https://linkedin.com/in/henriquecsousa" target="_blank" class="mx-2" data-umami-event="visit-linkedin">
                    <i class="fab fa-linkedin text-2xl"></i>
                </a>
            </div>
            <p class="text-center text-gray-500 text-sm">
                <a href="https://sousadev.com/terms-and-conditions.html" target="_blank" rel="noopener noreferrer" data-i18n="termsAndConditions" data-umami-event="view-terms-and-conditions">Termos e Condições</a> 
                / 
                <a href="https://sousadev.com/privacy-policy.html" target="_blank" rel="noopener noreferrer" data-i18n="privacyPolicy" data-umami-event="view-privacy-policy">Política de Privacidade</a>
            </p>
        </div>
    </section>
    
    <script src="js/i18n.js" defer></script>
    <!-- JavaScript Logic -->
    <script>
        function showLoadingSpinner() {
            document.getElementById('loadingSpinner').classList.remove('hidden');
        }

        function hideLoadingSpinner() {
            document.getElementById('loadingSpinner').classList.add('hidden');
        }
        function toggleSpoiler() {
            var spoilerContent = document.getElementById('spoilerContent');
            var spoilerArrow = document.getElementById('spoilerArrow');
            spoilerContent.classList.toggle('hidden');
            spoilerArrow.classList.toggle('rotate-180');
        }

        function loadViatorWidget(language) {
            const widgetContainer = document.getElementById('viatorWidget');
            widgetContainer.innerHTML = ''; // Clear previous widget
            let widgetRef;

            switch (language) {
                case 'pt':
                    widgetRef = 'W-9498a477-c822-45c2-8ac8-1a241c13a34c';
                    break;
                case 'fr':
                    widgetRef = 'W-f73fa3e1-fd82-4cfe-b32c-7a7cd7e6bc70';
                    break;
                case 'de':
                    widgetRef = 'W-7be85e92-9d74-4086-89f4-cc11540ff074';
                    break;
                case 'es':
                    widgetRef = 'W-619d8787-da9d-449b-b071-61e28e34bc02';
                    break;
                default:
                    widgetRef = 'W-00e6047e-b988-4a48-823b-d534a5a5ff04';
            }

            widgetContainer.innerHTML = `<div data-vi-partner-id="P00222801" data-vi-widget-ref="${widgetRef}"></div>`;
            const script = document.createElement('script');
            script.src = 'https://www.viator.com/orion/partner/widget.js';
            script.async = true;
            script.onload = function() {
                setTimeout(function() {
                    document.getElementById('loadingToursInfo').classList.add('hidden');
                }, 3000);
            };
            document.body.appendChild(script);
        }

        function showPage(pageId) {
            const pages = document.querySelectorAll('.page');
            
            pages.forEach(page => {
                if (page.id === pageId) {
                    page.classList.add('active');
                    page.classList.remove('hidden');
                } else {
                    page.classList.remove('active');
                    page.classList.add('hidden');
                }
            });
            // Scroll to the top of the page
            window.scrollTo(0, 0);

            // Change the browser title based on the page
            let pageTitle = t('pageTitle', 'São Miguel Bus');
            switch(pageId) {
                case 'home':
                    pageTitle += ' - ' + t('navBarSearchLabel', 'Home');
                    break;
                case 'routes':
                    pageTitle += ' - ' + t('navBarRoutesLabel', 'Routes');
                    break;
                case 'tours':
                    pageTitle += ' - ' + t('navBarToursLabel', 'Tours');
                    break;
                case 'advert':
                    pageTitle += ' - ' + t('navBarAdvertLabel', 'Advertise');
                    break;
                case 'info':
                    pageTitle += ' - ' + t('navBarInfoLabel', 'Info');
                    break;
            }
            document.title = pageTitle;
        }

        // Page switching logic
        document.addEventListener('DOMContentLoaded', function() {
            setTodayDate();
            initializeAdRemoval(); // Initialize ad removal system
            
            // Initialize bus tracking system with enhanced status display
            if (typeof BusTrackingHandler !== 'undefined') {
                BusTrackingHandler.init();
            }
            
            // Initialize bus tracking UI with enhanced display
            if (typeof BusTrackingUI !== 'undefined') {
                BusTrackingUI.init();
            }
            
            const pages = document.querySelectorAll('.page');
            const navLinks = document.querySelectorAll('nav a[data-target]');

            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetPage = this.getAttribute('data-target');
                    showPage(targetPage);

                    // Update active state of nav links
                    navLinks.forEach(navLink => {
                        if (navLink === this) {
                            navLink.classList.add('text-green-600');
                            navLink.classList.remove('text-gray-600');
                        } else {
                            navLink.classList.remove('text-green-600');
                            navLink.classList.add('text-gray-600');
                        }
                    });
                });
            });

            // Check if the user is on Android or iOS
            const urlParams = new URLSearchParams(window.location.search);
            const deviceParam = urlParams.get('device');

            if (deviceParam !== 'android-app') {
                if (/Android/i.test(navigator.userAgent)) {
                    document.getElementById('installAndroidApp').classList.remove('hidden');
                } else if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {
                    document.getElementById('installIOSApp').classList.remove('hidden');
                }
            }
            loadViatorWidget(currentLanguage);

        });

        // Add event listener for btnRoutes
        document.getElementById('btnRoutes').addEventListener('click', function() {
            redirectToStepByStepDirections();
        });

        // Add event listener for btnRoutesStepByStep
        document.getElementById('btnRoutesStepByStep').addEventListener('click', function() {
            const origin = document.getElementById('originStepByStep').value;
            const destination = document.getElementById('destinationStepByStep').value;
            const date = document.getElementById('datePickerStepByStep').value;
            const time = document.getElementById('timeStepByStep').value;

            // Switch to the home page
            showPage('home');

            // Update the form values on the Directions page
            document.getElementById('origin').value = origin;
            document.getElementById('destination').value = destination;
            document.getElementById('datePicker').value = date;
            document.getElementById('time').value = time;
        });

        // Toggle Navigation Menu on Mobile Top Navbar if implemented
        document.getElementById('nav-toggle')?.addEventListener('click', function() {
            const mainNav = document.getElementById('mainNav');
            mainNav.classList.toggle('hidden');
        });

        function swapOriginDestination() {
            const originInput = document.getElementById('origin');
            const destinationInput = document.getElementById('destination');
            const originInputStepByStep = document.getElementById('originStepByStep');
            const destinationInputStepByStep = document.getElementById('destinationStepByStep');

            const swapIcon = document.getElementById('swapIcon');
            const swapIconStepByStep = document.getElementById('swapIconStepByStep');
            
            // Swap the values
            const temp = originInput.value;
            originInput.value = destinationInput.value;
            destinationInput.value = temp;

            const tempStepByStep = originInputStepByStep.value;
            originInputStepByStep.value = destinationInputStepByStep.value;
            destinationInputStepByStep.value = tempStepByStep;

            
            // Animate the icon
            swapIcon.classList.add('rotate-icon');
            setTimeout(() => {
                swapIcon.classList.remove('rotate-icon');
            }, 300); // Remove the class after the animation duration

            swapIconStepByStep.classList.add('rotate-icon');
            setTimeout(() => {
                swapIconStepByStep.classList.remove('rotate-icon');
            }, 300); // Remove the class after the animation duration
        }

        // Initial Load: Show 'home' page
        document.addEventListener('DOMContentLoaded', function() {
            showPage('home');
        });

        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        // Service worker registered successfully
                    })
                    .catch(err => {
                        console.error('ServiceWorker registration failed: ', err);
                    });
            });
        }

        // Function to determine day type and update the message
        function checkDayType(inputId = 'datePicker') {
            const dateInput = document.getElementById(inputId);
            const dayTypeMessage = document.getElementById('dayTypeMessage');
            
            // Get the selected date
            const selectedDate = new Date(dateInput.value);
            
            // Check if the date is valid
            if (!isNaN(selectedDate)) {
                return dateInput.value
                // const day = selectedDate.getDay(); // 0 = Sunday, 1 = Monday, ..., 6 = Saturday
                
                // // Determine the day type
                // let dayTypeKey;
                // if (day === 0) {
                //     dayTypeKey = "sunday";
                // } else if (day === 6) {
                //     dayTypeKey = "saturday";
                // } else {
                //     dayTypeKey = "weekday";
                // }
                
                // return dayTypeKey;
            } else {
                return null;
            }
        }

        // Function to set today's date on page load
        function setTodayDate() {
            const datePicker = document.getElementById('datePicker');
            const datePickerStepByStep = document.getElementById('datePickerStepByStep');
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0'); // Months are zero-based
            const day = String(today.getDate()).padStart(2, '0');
            const todayStr = `${year}-${month}-${day}`;
            
            if (datePicker) {
                datePicker.value = todayStr;
                checkDayType('datePicker');
            }
            
            if (datePickerStepByStep) {
                datePickerStepByStep.value = todayStr;
                checkDayType('datePickerStepByStep');
            }
        }
        // Helper function to calculate total travel time
        function calculateTotalTravelTime(firstStopTime, lastStopTime) {
            const firstTime = firstStopTime.split('h');
            const lastTime = lastStopTime.split('h');
            const firstDate = new Date(0, 0, 0, firstTime[0], firstTime[1], 0);
            const lastDate = new Date(0, 0, 0, lastTime[0], lastTime[1], 0);

            // Adjust for next day if last time is less than first time
            if (lastDate.getTime() < firstDate.getTime()) {
                lastDate.setDate(lastDate.getDate() + 1);
            }

            let diff = lastDate.getTime() - firstDate.getTime();
            let hours = Math.floor(diff / 1000 / 60 / 60);
            diff -= hours * 1000 * 60 * 60;
            let minutes = Math.floor(diff / 1000 / 60);

            return {
                hours: hours,
                minutes: minutes,
                formatted: `${hours > 0 ? `${hours < 10 ? '0' + hours : hours}h` : ''}${minutes < 10 ? '0' + minutes : minutes} min`
            };
        }

        // Function to set random ad banner styles
        function setRandomAdBannerStyles() {
            const adBanners = [
                { contentId: 'homeAdContent', bannerId: 'homeAdBanner' },
                { contentId: 'routesAdContent', bannerId: 'routesAdBanner' }
            ];

            const adStyles = [
                {
                    // Original yellow/orange style
                    gradient: 'bg-gradient-to-r from-yellow-400 to-orange-500',
                    content: `
                        <div class="flex items-center justify-center mb-1">
                            <i class="fas fa-crown text-xl mr-2"></i>
                            <p class="font-bold text-lg" data-i18n="removeAdsTitle">REMOVE ADS</p>
                        </div>
                        <p class="text-sm opacity-90">
                            <span data-i18n="clickToRemoveAds">Click to remove ads</span>
                        </p>
                        <div class="mt-2 text-xs opacity-80">
                            <i class="fas fa-hand-pointer mr-1"></i>
                            <span data-i18n="clickToRemoveAds">Click to remove ads</span>
                        </div>
                    `
                },
                {
                    // New purple/pink style
                    gradient: 'bg-gradient-to-r from-purple-400 to-pink-500',
                    content: `
                        <div class="flex items-center justify-center mb-1">
                            <i class="fas fa-star text-xl mr-2"></i>
                            <p class="font-bold text-lg" data-i18n="tiredOfAdsTitle">TIRED OF ADS?</p>
                        </div>
                        <p class="text-sm opacity-90">
                            <span data-i18n="upgradeNowButton">Upgrade Now</span>
                        </p>
                        <div class="mt-2 text-xs opacity-80">
                            <i class="fas fa-hand-pointer mr-1"></i>
                            <span data-i18n="clickToRemoveAds">Click to remove ads</span>
                        </div>
                    `
                },
                {
                    // Blue/teal tracking style
                    gradient: 'bg-gradient-to-r from-blue-400 to-teal-500',
                    content: `
                        <div class="flex items-center justify-center mb-1">
                            <i class="fas fa-bus text-xl mr-2"></i>
                            <p class="font-bold text-lg" data-i18n="trackBusesTitle">TRACK BUSES</p>
                        </div>
                        <p class="text-sm opacity-90">
                            <span data-i18n="realTimeTrackingText">Real-time arrival estimates</span>
                        </p>
                        <div class="mt-2 text-xs opacity-80">
                            <i class="fas fa-crown mr-1"></i>
                            <span data-i18n="unlockTrackingText">Unlock tracking</span>
                        </div>
                    `
                },
                {
                    // Green/emerald pin routes style
                    gradient: 'bg-gradient-to-r from-green-400 to-emerald-500',
                    content: `
                        <div class="flex items-center justify-center mb-1">
                            <i class="fas fa-thumbtack text-xl mr-2"></i>
                            <p class="font-bold text-lg" data-i18n="pinRoutesTitle">PIN ROUTES</p>
                        </div>
                        <p class="text-sm opacity-90">
                            <span data-i18n="dailyTrackingText">Track your daily routes</span>
                        </p>
                        <div class="mt-2 text-xs opacity-80">
                            <i class="fas fa-crown mr-1"></i>
                            <span data-i18n="unlockButton">Unlock</span>
                        </div>
                    `
                }
            ];

            adBanners.forEach(banner => {
                const contentElement = document.getElementById(banner.contentId);
                if (contentElement) {
                    // Randomly choose a style (0 or 1)
                    const randomStyle = adStyles[Math.floor(Math.random() * adStyles.length)];
                    
                    // Apply the gradient class
                    contentElement.className = `text-white p-3 text-center ${randomStyle.gradient}`;
                    
                    // Set the content
                    contentElement.innerHTML = randomStyle.content;
                }
            });

            // Update translations if they're loaded
            if (typeof updatePageContent === 'function') {
                updatePageContent();
            }
        }

        // Set random styles on page load
        document.addEventListener('DOMContentLoaded', function() {
            setRandomAdBannerStyles();
            
            // Change banner styles every 30 seconds for more dynamic appearance
            setInterval(setRandomAdBannerStyles, 30000);
        });
    </script>

    <!-- External JS Files -->
    <script src="js/offlineHandler.js" defer></script>
    <script src="js/apiHandler.js" defer></script>
    <script src="js/directionsApiHandler.js" defer></script>
    <script src="js/favoriteHandler.js" defer></script>
    <script src="js/languageModal.js" defer></script>
    <script src="js/adRemovalHandler.js" defer></script>
    <script src="js/busTrackingHandler.js" defer></script>
    <script src="js/busTrackingUI.js" defer></script>

    <!-- Add this script within your existing JavaScript block -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initially show the instructional cards
            document.getElementById('homeInstructionCard').classList.remove('hidden');
            document.getElementById('routesInstructionCard').classList.remove('hidden');

            // Hide Home Instructional Card after a search is performed
            document.getElementById('btnSubmit').addEventListener('click', function() {
                document.getElementById('homeInstructionCard').classList.add('hidden');
            });

            // Hide Routes Instructional Card when a route is selected or directions are viewed
            document.getElementById('btnSubmitStepByStep').addEventListener('click', function() {
                document.getElementById('routesInstructionCard').classList.add('hidden');
            });
        });
    </script>
    <script>
        function setCookie(name, value, days) {
            let expires = "";
            if (days) {
                const date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                expires = "; expires=" + date.toUTCString();
            }
            document.cookie = name + "=" + (value || "")  + expires + "; path=/";
        }

        function getCookie(name) {
            const nameEQ = name + "=";
            const ca = document.cookie.split(';');
            for(let i=0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) == ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
        }

        function deleteCookie(name) {
            document.cookie = name + '=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';
        }
    </script>

    <!-- Interstitial Ad Modal -->
    <div id="interstitialAdModal" class="fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center hidden p-4">
        <div class="bg-white rounded-lg p-4 sm:p-6 w-full max-w-sm sm:max-w-md mx-auto relative max-h-[90vh] overflow-y-auto">
            <button id="closeInterstitialAd" class="text-gray-600 w-full text-right hover:text-gray-800 transition duration-300 ease-in-out mb-2" onclick="closeInterstitialAd()" data-umami-event="close-interstitial-ad">
                <i class="fas fa-times text-xl text-right"></i>
            </button>
            
            <!-- Banner Ad inside Interstitial -->
            <div id="interstitialBannerAd" class="mb-4 relative">
                <span class="absolute top-0 left-0 bg-green-500 text-white text-xs font-bold px-2 py-1 rounded-tl-lg rounded-br-lg z-10">AD</span>
                <div id="interstitialAdContent" class="bg-gray-100 rounded-lg overflow-hidden" style="min-height: 120px;">
                    <!-- Ad banner will be loaded here -->
                    <div class="flex items-center justify-center h-20 text-gray-500">
                        <div class="animate-pulse">Loading ad...</div>
                    </div>
                </div>
            </div>
            
            <div class="text-center">
                <i class="fas fa-crown text-4xl sm:text-5xl text-green-500 mb-3 sm:mb-4"></i>
                <h3 class="text-lg sm:text-xl font-semibold text-green-600 mb-2" data-i18n="upgradeForBetterTitle">Upgrade for Better Experience!</h3>
                <p class="text-sm sm:text-base text-gray-700 mb-2" data-i18n="interstitialAdDescription">
                    Remove all ads, track your buses in real-time, and pin your favorite routes.
                </p>
                
                <!-- Free Trial Badge -->
                <div class="inline-block bg-gradient-to-r from-green-400 to-green-600 text-white px-3 py-1 rounded-full text-xs font-bold mb-4">
                    <span data-i18n="freeTrialBadge">14-day free trial</span>
                </div>
                
                <button onclick="window.open('https://buy.stripe.com/5kQ28qfMb773g0d3MdgUM03', '_blank'); closeInterstitialAd();" 
                        class="w-full bg-green-500 text-white py-2 sm:py-3 rounded-lg hover:bg-green-600 transition duration-300 mb-3 text-sm sm:text-base"
                        data-umami-event="interstitial-ad-free-trial">
                    <i class="fas fa-gift mr-2"></i>
                    <span data-i18n="startFreeTrialButton">Start 14-day Free Trial</span>
                </button>
                
                <button onclick="closeInterstitialAd()" 
                        class="w-full text-gray-500 text-xs sm:text-sm hover:text-gray-700"
                        data-umami-event="interstitial-ad-continue">
                    <span data-i18n="continueWithAdsButton">Continue with ads</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        function showInterstitialAd() {
            // Only show if not premium user
            const isPremium = adRemovalState && adRemovalState.isActive;
            const isDismissed = getCookie('interstitialDismissed');
            const hasSearched = sessionStorage.getItem('hasSearchedThisSession');
            const sessionDismissed = sessionStorage.getItem('interstitialDismissedThisSession');
            
            if (!isPremium) {
                // Check if this is the first search of this session
                if (!hasSearched && !sessionDismissed) {
                    // First search of the session - always show (ignore cookie dismissal for first search)
                    sessionStorage.setItem('hasSearchedThisSession', 'true');
                    loadInterstitialBannerAd();
                    document.getElementById('interstitialAdModal').classList.remove('hidden');
                    return;
                }
                
                // For subsequent searches, respect both cookie and session dismissal
                if (!isDismissed && !sessionDismissed) {
                    // Subsequent searches in this session - show on 15% chance
                    if (Math.random() < 0.15) {
                        loadInterstitialBannerAd();
                        document.getElementById('interstitialAdModal').classList.remove('hidden');
                    }
                }
            }
        }
        
        function loadInterstitialBannerAd() {
            const interstitialAdContent = document.getElementById('interstitialAdContent');
            
            // Skip loading ad on localhost
            if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
                interstitialAdContent.innerHTML = `
                    <div class="bg-gradient-to-r from-blue-400 to-purple-500 text-white p-4 text-center">
                        <h4 class="font-bold">Sample Ad Banner</h4>
                        <p class="text-sm">This would be a real ad in production</p>
                    </div>
                `;
                return;
            }

            const apiUrl = `https://api.saomiguelbus.com/api/v1/ad?on=interstitial&platform=web`;

            fetch(apiUrl)
                .then(response => { 
                    if (response.ok) {
                        return response.json();
                    } else {
                        console.warn('No interstitial ad available');
                        throw new Error('No ad available');
                    }
                })
                .then(ad => {
                    if (ad) {
                        let hrefValue;
                        if (ad.action === 'directions') {
                            hrefValue = `https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(ad.target)}`;
                        } else {
                            hrefValue = ad.target;
                        }

                        interstitialAdContent.innerHTML = `
                            <a href="${hrefValue}" target="_blank" class="block interstitial-ad-clickable" data-ad-id="${ad.id}" data-umami-event="interstitial-banner-click">
                                <img src="${ad.media}" alt="${ad.entity}" class="w-full h-auto rounded-lg" style="max-height: 120px; object-fit: contain; background-color: #f3f4f6;">
                            </a>
                        `;

                        // Add click tracking
                        const adClickable = interstitialAdContent.querySelector('.interstitial-ad-clickable');
                        if (adClickable) {
                            adClickable.addEventListener('click', function(event) {
                                const adId = this.getAttribute("data-ad-id");
                                const URL = "https://api.saomiguelbus.com/api/v1/ad/click?id=" + encodeURIComponent(adId);
                                fetch(URL, {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json',
                                    },
                                    mode: 'cors',
                                })
                                .then(response => response.json())
                                .then(response => response.json())
                                .catch(error => console.error(error));
                            });
                        }
                    }
                })
                .catch(error => {
                    console.error('Error loading interstitial ad:', error);
                    // Show fallback content
                    interstitialAdContent.innerHTML = `
                        <div class="bg-gradient-to-r from-green-400 to-blue-500 text-white p-4 text-center">
                            <h4 class="font-bold text-sm" data-i18n="removeAdsTitle">Remove Ads</h4>
                            <p class="text-xs opacity-90" data-i18n="upgradeForAdsFreTitle">Upgrade for ad-free experience</p>
                        </div>
                    `;
                });
        }
        
        function closeInterstitialAd() {
            document.getElementById('interstitialAdModal').classList.add('hidden');
            // Remember dismissal for this session (prevents showing again in same session)
            sessionStorage.setItem('interstitialDismissedThisSession', 'true');
            // Also set a shorter cookie to prevent too frequent showing across sessions
            setCookie('interstitialDismissed', 'true', 0.021); // 30 minutes = 0.021 days
        }
    </script>

    <div id="loadingSpinner" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
        <div class="animate-spin rounded-full h-32 w-32 border-t-2 border-b-2 border-green-500"></div>
    </div>

    <script>
        // Make function globally accessible for debugging
        window.showInterstitialAd = showInterstitialAd;
        window.loadInterstitialBannerAd = loadInterstitialBannerAd;
        window.closeInterstitialAd = closeInterstitialAd;
        
        // Debug function to test interstitial manually
        window.testInterstitial = function() {
            loadInterstitialBannerAd();
            document.getElementById('interstitialAdModal').classList.remove('hidden');
        };
    </script>

    <!-- Toggle sections -->
    <script>
        function toggleActiveTrackingSection() {
            const list = document.getElementById('activeTrackingList');
            const icon = document.getElementById('activeTrackingToggleIcon');
            
            if (list.classList.contains('max-h-0')) {
                // Expand
                list.classList.remove('max-h-0');
                list.classList.add('max-h-96');
                icon.classList.remove('fa-chevron-down');
                icon.classList.add('fa-chevron-up');
            } else {
                // Collapse
                list.classList.remove('max-h-96');
                list.classList.add('max-h-0');
                icon.classList.remove('fa-chevron-up');
                icon.classList.add('fa-chevron-down');
            }
        }

        function togglePinnedRoutesSection() {
            const list = document.getElementById('pinnedRoutesList');
            const icon = document.getElementById('pinnedRoutesToggleIcon');
            
            if (list.classList.contains('max-h-0')) {
                // Expand
                list.classList.remove('max-h-0');
                list.classList.add('max-h-96');
                icon.classList.remove('fa-chevron-down');
                icon.classList.add('fa-chevron-up');
            } else {
                // Collapse
                list.classList.remove('max-h-96');
                list.classList.add('max-h-0');
                icon.classList.remove('fa-chevron-up');
                icon.classList.add('fa-chevron-down');
            }
        }

        // Make toggle functions globally accessible
        window.toggleActiveTrackingSection = toggleActiveTrackingSection;
        window.togglePinnedRoutesSection = togglePinnedRoutesSection;

        // Open feature request email
        function openFeatureRequestEmail() {
            const subject = encodeURIComponent('Feature Request / App Changes - São Miguel Bus');
            const body = encodeURIComponent('Hello,\n\nI would like to suggest the following feature or change for the São Miguel Bus app:\n\n[Please describe your suggestion here]\n\nThank you for your time and for creating this amazing app!\n\nBest regards,');
            const mailtoLink = `mailto:info@saomiguelbus.com?subject=${subject}&body=${body}`;
            window.open(mailtoLink, '_blank');
        }

        // Make the function globally accessible
        window.openFeatureRequestEmail = openFeatureRequestEmail;
    </script>
</body>
</html>
